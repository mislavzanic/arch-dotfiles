#!/bin/bash

clean_xmonad() {
    cd $HOME/dotfiles/.config/xmonad
    rm -rf .stack-work
    rm -rf mexmonad.cabal
    rm -rf stack.yaml.lock
    rm -rf xmonad.hi xmonad.o
}

backup_git() {
    cd "$1"
    git add .
    git commit -m "$2"
    git push origin master
}

backup_sys_dots() {
    git clone git@github.com:mislavzanic/dotfiles.git $HOME/dotfiles
    [ -d "$HOME/.local/bin/scripts" ] && rm -rf $HOME/dotfiles/.local/bin/scripts && cp -r "$HOME/.local/bin/scripts" "$HOME/dotfiles/.local/bin/"
    for item in doom slock dunst compton shell x11 zsh nvim xmonad alacritty dmenu sxiv; do
        [ -d "${XDG_CONFIG_HOME:-$HOME/.config}/$item" ] &&  rm -rf $HOME/dotfiles/.config/$item && cp -r "${XDG_CONFIG_HOME:-$HOME/.config}/$item" $HOME/dotfiles/.config/
    done
    clean_xmonad
    backup_git $HOME/dotfiles "$1"
    cd $HOME
    rm -rf $HOME/dotfiles
}

backup_install() {
    [ -d $HOME/.local/bin/arch_install ] && { backup_git $HOME/.local/bin/arch_install "$1" && exit; } || { git clone git@github.com:mislavzanic/arch_install.git && exit; }
}

backup() {
    [ "$1" == 'dots' ] && backup_sys_dots "$2"
    [ "$1" == 'install' ] && backup_install "$2"
}

BACKUP=''
MESSAGE='backup'

while [ $# -gt 0 ]; do

   if [[ $1 == *"--"* ]]; then
        param="${1/--/}"
        [ $param == 'backup' ] && BACKUP="$2"
        [ $param == 'message' ] && MESSAGE="$2"
   fi

  shift
done

backup "$BACKUP" "$MESSAGE"
